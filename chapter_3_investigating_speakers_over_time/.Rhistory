# - Format the table for PDF output (kable(), kable_styling())
# - Adjust column widths for better layout (column_spec())
hansard_1830_w_year %>%
head() %>%
mutate(text = str_trunc(text, 120)) %>%
kable("latex", booktabs = TRUE) %>%
kable_styling(latex_options = c("hold_position"),
full_width = FALSE,
position = "left") %>%
column_spec(2, width = "6cm") %>%
column_spec(4, width = "4cm")
rm(words_1830)
gc()
words_1830_w_year <- hansard_1830_w_year %>%
left_join(speaker_metadata_1830) %>%
select(speaker, suggested_speaker, text, year) %>%
unnest_tokens(word, text)
words_1830_w_year %>%
head() %>%
select(speaker, word, year) %>%
kable() #look at the first few columns of the dataset
words_per_speaker_1830 <- words_1830_w_year %>%
filter(suggested_speaker != "") %>%
group_by(speaker, year) %>%
summarize(speaker_words_per_year = n()) %>%
arrange(desc(speaker_words_per_year))
head(words_per_speaker_1830)
data("hansard_1820")
data("speaker_metadata_1820")
data("file_metadata_1820")
mrs_walrand_speaker_metadata <- speaker_metadata_1820 %>%
filter(str_detect(speaker, regex("Mrs(.*)Walrand", ignore_case = T)))
mrs_walrand_sentences <- left_join(mrs_walrand_speaker_metadata,
file_metadata_1820, by = "sentence_id") %>%
left_join(., hansard_1820, by = "sentence_id") %>%
select(debate_id, text)
mrs_walrand_sentences %>%
head() %>%
mutate(text = str_trunc(text, 120)) %>%
kable(format = "latex",
booktabs = TRUE,
caption = "Sentences uttered by Mrs. Walrand in the 1820 Hansard debates.") %>%
kable_styling(full_width = FALSE, position = "left") %>%
column_spec(2, width = "10cm")
entire_debate <- hansard_1820 %>%
left_join(file_metadata_1820, hansard_1820, by = "sentence_id") %>%
filter(debate_id == 5142) %>%
select("text")
debate_table <- tibble(text = head(entire_debate$text, 20))
debate_table %>%
kable(format = "latex",
booktabs = TRUE,
caption = "Excerpt of Debate Text (First 20 Sentences)") %>%
kable_styling(latex_options = c("hold_position", "scale_down"),
full_width = FALSE,
position = "left") %>%
column_spec(1, width = "16cm")
mrs_walrand_top_words <- left_join(mrs_walrand_speaker_metadata, hansard_1820) %>%
unnest_tokens(word, text) %>%
anti_join(stop_words) %>%
filter(is.na(as.numeric(word))) %>%
group_by(speaker, word) %>%
summarize(n = n()) %>%
arrange(desc(n)) %>%
top_n(30)
ggplot(data = mrs_walrand_top_words,
aes(x = reorder(word, n), y = n)) +
geom_col() +
coord_flip() +
labs(title = "Mrs. Walrand\'s Top Words",
subtitle = "From \"Motion Respecting the Trial and Condemnation of
Missionary Smith at Demerara\"",
x = "Word",
y = "Count")
# make two categories, pre- and post-reform
# data("hansard_1840")
#
# hansard_1820 <- hansard_1820 %>%
#   left_join(speaker_metadata_1820) %>%
#   left_join(debate_metadata_1820)
#
# hansard_1830 <- hansard_1830 %>%
#   left_join(speaker_metadata_1830) %>%
#   left_join(debate_metadata_1830)
#
# hansard_1840 <- hansard_1840 %>%
#   left_join(speaker_metadata_1840) %>%
#   left_join(debate_metadata_1840)
#
# hansard <- bind_rows(hansard_1820, hansard_1830, hansard_1840)
#
# # find all the prereform text and speaker names
# prereform <- hansard %>% #hansard_1830 %>%
#   select(sentence_id, speechdate, debate, text, speaker, suggested_speaker) %>%
#   filter(speechdate <= as.Date("1832-6-4")) %>%
#   filter(speechdate >= as.Date("1822-6-4")) %>%
#   mutate(year = year(speechdate)) %>%
#   mutate(suggested_speaker = coalesce(suggested_speaker, speaker)) %>%
#   mutate(period = "prereform")
#
# # find all the postreform text and speaker names
# postreform <- hansard %>%
#   select(sentence_id, speechdate, debate, text, speaker, suggested_speaker) %>%
#   filter(speechdate >= as.Date("1832-6-4")) %>%
#   filter(speechdate <= as.Date("1842-6-4")) %>%
#   mutate(year = year(speechdate)) %>%
#   mutate(suggested_speaker = coalesce(suggested_speaker, speaker)) %>%
#   mutate(period = "postreform")
data("hansard_1840")
data("speaker_metadata_1840")
data("debate_metadata_1840")
# A helper function to (1) join metadata, (2) keep only needed columns,
# (3) filter to the window of interest, and (4) add year + prereform/postreform labels.
prep_hansard <- function(hansard_df, speaker_meta, debate_meta) {
hansard_df %>%
# Keep the smallest set of columns before joins to reduce memory pressure
select(sentence_id, text) %>%
# Explicit join keys to avoid accidental many-to-many blowups
left_join(speaker_meta, by = "sentence_id") %>%
left_join(debate_meta,  by = "sentence_id") %>%  # change if debate_meta uses another key
# Keep only what we will analyze downstream
select(sentence_id, speechdate, debate, text, speaker, suggested_speaker) %>%
# Restrict the corpus to our analytical time window (filter early)
filter(
speechdate >= as.Date("1822-06-04"),
speechdate <= as.Date("1842-06-04")
) %>%
mutate(
year = year(speechdate),
# Prefer curated suggested_speaker; fall back to raw speaker when missing/blank
suggested_speaker = coalesce(na_if(suggested_speaker, ""), speaker),
# Label prereform vs postreform
period = if_else(
speechdate < as.Date("1832-06-04"),
"prereform",
"postreform"
)
)
}
# Build one combined dataset (more memory-efficient than making hansard then duplicating it)
hansard_periods <- bind_rows(
prep_hansard(hansard_1820, speaker_metadata_1820, debate_metadata_1820),
prep_hansard(hansard_1830, speaker_metadata_1830, debate_metadata_1830),
prep_hansard(hansard_1840, speaker_metadata_1840, debate_metadata_1840)
)
# Optional: if you no longer need the decade objects, remove them to free RAM
rm(hansard_1820, hansard_1830, hansard_1840,
speaker_metadata_1820, speaker_metadata_1830, speaker_metadata_1840,
debate_metadata_1820, debate_metadata_1830, debate_metadata_1840)
gc()
# Optional: create separate prereform/postreform datasets only if needed
prereform  <- hansard_periods %>% filter(period == "prereform")
postreform <- hansard_periods %>% filter(period == "postreform")
# LETS TRY THIS:
# --- 1) Build a single, trimmed dataset with a prereform/postreform label ---
prep_hansard <- function(hansard_df, speaker_meta, debate_meta) {
hansard_df %>%
select(sentence_id, text) %>%                                # keep minimal cols pre-join
left_join(speaker_meta, by = "sentence_id") %>%              # explicit join key
left_join(debate_meta,  by = "sentence_id") %>%              # adjust key if needed
select(sentence_id, speechdate, debate, text, speaker, suggested_speaker) %>%
filter(
speechdate >= as.Date("1822-06-04"),
speechdate <= as.Date("1842-06-04")
) %>%
mutate(
year = year(speechdate),
suggested_speaker = coalesce(na_if(suggested_speaker, ""), speaker),
period = if_else(speechdate < as.Date("1832-06-04"),
"prereform", "postreform")
)
}
hansard_periods <- bind_rows(
prep_hansard(hansard_1820, speaker_metadata_1820, debate_metadata_1820),
prep_hansard(hansard_1830, speaker_metadata_1830, debate_metadata_1830),
prep_hansard(hansard_1840, speaker_metadata_1840, debate_metadata_1840)) %>%
mutate(period = factor(period, levels = c("prereform", "postreform")))
# Optional: drop big source objects if you won't reuse them
rm(hansard_1820, hansard_1830, hansard_1840,
speaker_metadata_1820, speaker_metadata_1830, speaker_metadata_1840,
debate_metadata_1820, debate_metadata_1830, debate_metadata_1840)
gc()
# --- 2) Memory-efficient word counts by period (NO prereform_words/postreform_words objects) ---
both_periods_word_count <- hansard_periods %>%
select(period, text) %>%
unnest_tokens(word, text) %>%
anti_join(stop_words, by = "word") %>%
count(period, word, name = "wordcount", sort = TRUE)
# --- 3) Total (stopword-removed) word volume per period ---
both_periods_word_count_totals <- both_periods_word_count %>%
group_by(period) %>%
summarize(total = sum(wordcount), .groups = "drop")
# --- 4) (Recommended for DH) compare relative frequency across periods ---
# This controls for corpus size differences.
word_props <- both_periods_word_count %>%
group_by(period) %>%
mutate(prop = wordcount / sum(wordcount)) %>%
ungroup()
word_diff <- word_props %>%
select(period, word, prop) %>%
pivot_wider(names_from = period, values_from = prop, values_fill = 0) %>%
mutate(diff = postreform - prereform) %>%
arrange(desc(diff))
# Examples: most distinctive words in each direction
top_postreform <- word_diff %>% slice_head(n = 25)   # postreform-leaning
top_prereform  <- word_diff %>% slice_tail(n = 25)   # prereform-leaning
# Optional: inspect
head(both_periods_word_count)
both_periods_word_count_totals
head(top_postreform)
head(top_prereform)
# create a bar chart
library(scales) # a library useful for formatting numbers
ggplot(both_periods_word_count_totals, aes(x = period, y = total)) +
geom_col((aes(fill = period))) +
scale_fill_grey() +
scale_y_continuous(label=comma) +
geom_text(aes(label = (paste0(scales::comma(total), " words"))),
colour = "white",
vjust = 1.5) +
labs(title = "How Many Words Were Spoken in Each Period?",
x = "",
y = "words")
# subtract the prereform total wordcount from the postreform total word count to find the difference
both_periods_word_count_totals$total[2] - both_periods_word_count_totals$total[1]
# top words
top_words <- both_periods_word_count %>%
group_by(period) %>%
slice_max(order_by = wordcount, # put the words in descending order by "wordcount," the column for the count
n = 10) # the argument "n" for the function "slice_max" takes the number of positions from the top to retain
library(gt)
# make a table
top_words %>%
gt() %>% # we're using the "great tables" package to make an elegant table
fmt_number( # format the numbers in the table
columns = everything(), # apply to all numbers
decimals = 0, # no decimals
use_seps = TRUE # use commas
) %>%
tab_header(title = "The Top Ten Words Spoken in Prereform and Postreform Parliament") %>%
tab_style(
style = list(cell_text(weight = "bold")),
locations = cells_row_groups()
) %>%
tab_style( # format the column labels
style = list(
cell_fill(color = "black"),
cell_text(weight = "bold", color = "white")
),
locations = cells_column_labels()
) %>%
tab_style( # format the title
style = list(
cell_fill(color = "lightgray"),
cell_text(weight = "bold")
),
locations = cells_title()
)
# top words
top_words <- both_periods_word_count %>%
group_by(period) %>%
slice_max(order_by = wordcount, # put the words in descending order by "wordcount," the column for the count
n = 10) # the argument "n" for the function "slice_max" takes the number of positions from the top to retain
top_words %>%
kable(
caption = "The Top Ten Words Spoken in Prereform and Postreform Parliament",
digits = 0,
booktabs = TRUE
) %>%
kable_styling(full_width = FALSE, position = "left") %>%
row_spec(0, bold = TRUE, background = "black", color = "white") %>%  # column labels
add_header_above(c(" " = ncol(top_words))) %>%  # placeholder if grouping needed
column_spec(1:ncol(top_words), bold = FALSE)
# count words per speaker per year
prereform_speakers_wordcount <- prereform_words %>%
filter(str_trim(suggested_speaker) != "") %>%
group_by(suggested_speaker, year) %>%
summarize(wordcount = n()) %>%
ungroup() %>%
mutate(period = "prereform")
# count words per speaker per year
# prereform_speakers_wordcount <- prereform_words %>%
#   filter(str_trim(suggested_speaker) != "") %>%
#   group_by(suggested_speaker, year) %>%
#   summarize(wordcount = n()) %>%
#   ungroup() %>%
#   mutate(period = "prereform")
#
# postreform_speakers_wordcount <- postreform_words %>%
#   filter(str_trim(suggested_speaker) != "") %>%
#   group_by(suggested_speaker, year) %>%
#   summarize(wordcount = n()) %>%
#   ungroup() %>%
#   mutate(period = "postreform")
both_periods_speakers <- hansard_periods %>%
filter(!is.na(suggested_speaker),
str_trim(suggested_speaker) != "") %>%
count(period, suggested_speaker, year, name = "wordcount") %>%
mutate(period = factor(period, levels = c("prereform", "postreform")))
# glue them together
#both_periods_speakers <- rbind(prereform_speakers_wordcount, postreform_speakers_wordcount)
# inspect the data
head(both_periods_speakers)
# take the top speakers by wordcount
words_per_speaker <- both_periods_speakers %>%
group_by(suggested_speaker) %>%
summarize(wordsperspeaker = sum(wordcount))
top_speakers <- words_per_speaker %>%
slice_max(wordsperspeaker,
n = 5)
# inspect the data
top_speakers
# Use counting to investigate how many distinct speakers are in the data, pre and postreform
# How many speakers were there prereform?
prereform_only_speakers <- prereform_speakers_wordcount %>%
select(suggested_speaker) %>%
anti_join(postreform_speakers_wordcount, by = "suggested_speaker") %>%
mutate(class = "prereform only")
# Use counting to investigate how many distinct speakers are in the data, pre and postreform
# How many speakers were there prereform?
prereform_only_speakers <- both_periods_speakers %>%
filter(period == "prereform") %>%
select(suggested_speaker) %>%
distinct() %>%
anti_join(
both_periods_speakers %>%
filter(period == "postreform") %>%
select(suggested_speaker) %>%
distinct(),
by = "suggested_speaker"
) %>%
mutate(class = "prereform only")
# inspect the data
head(prereform_only_speakers)
# count the number of speakers in the dataset
nrow(prereform_only_speakers)
# How many speakers were there postreform?
postreform_only_speakers <- postreform_speakers_wordcount %>%
select(suggested_speaker) %>%
anti_join(prereform_speakers_wordcount) %>%
mutate(class = "postreform only")
# How many speakers were there postreform?
postreform_only_speakers <- both_periods_speakers %>%
filter(period == "postreform") %>%
select(suggested_speaker) %>%
distinct() %>%
anti_join(
both_periods_speakers %>%
filter(period == "prereform") %>%
select(suggested_speaker) %>%
distinct(),
by = "suggested_speaker"
) %>%
mutate(class = "postreform only")
# inspect the data
head(postreform_only_speakers)
# count the number of speakers in the dataset
nrow(postreform_only_speakers)
nrow(postreform_only_speakers) - nrow(prereform_only_speakers)
# How Many Members of Parliament Spoke Both Prereform and Postreform?
continuous_speakers <- prereform_speakers_wordcount %>%
distinct(suggested_speaker) %>%
inner_join(postreform_speakers_wordcount) %>%
ungroup() %>%
mutate(class = "both periods") %>%
distinct(suggested_speaker, class)
# How Many Members of Parliament Spoke Both Prereform and Postreform?
continuous_speakers <- both_periods_speakers %>%
filter(period == "prereform") %>%
select(suggested_speaker) %>%
distinct() %>%
inner_join(
both_periods_speakers %>%
filter(period == "postreform") %>%
select(suggested_speaker) %>%
distinct(),
by = "suggested_speaker"
) %>%
mutate(class = "both periods")
nrow(continuous_speakers)
# Count the number of speakers in each category
# glue together the data from each smaller dataset
all_classes <- rbind(prereform_only_speakers, postreform_only_speakers, continuous_speakers)
# group by period and count the number of speakers
all_classes_count <- all_classes %>%
group_by(class) %>%
summarize(speakercount = n()) %>%
arrange(desc(class))
# tell the computer to put the periods in the correct order
all_classes_count$class <- factor(all_classes_count$class, levels = c("prereform only", "postreform only", "both periods"))
# create a bar chart
ggplot(all_classes_count, aes(x = class, y = speakercount)) +
geom_col((aes(fill = class))) +
scale_fill_grey() +
geom_text(aes(label = paste0(speakercount, " speakers")),
colour = "white",
vjust = 1.5) +
labs(title = "How Many Speakers are in Each Category?", x = "", y = "speakers")
## Using Word Count:
## How much did speakers speak before and after the reform act?
# glue the data together for processing
all_per_speaker_wordcounts <- bind_rows(prereform_speakers_wordcount, postreform_speakers_wordcount) %>%
ungroup()
## Using Word Count:
## How much did speakers speak before and after the reform act?
all_speakers_annotated <- both_periods_speakers %>%
filter(!is.na(suggested_speaker)) %>%
left_join(all_classes, by = "suggested_speaker") %>%
ungroup()
all_speakers_annotated
# find the total wordcount_per_speaker
wordcount_per_speaker <-  all_speakers_annotated %>%
rename(wordcount_per_speaker_per_year = wordcount) %>%
group_by(class, suggested_speaker) %>%
summarize(wordcount_per_speaker = sum(wordcount_per_speaker_per_year))
# find the most prolific n speakers of each period
top_speakers <- wordcount_per_speaker %>%
filter(!is.na(suggested_speaker)) %>%
group_by(class) %>%
arrange(desc(wordcount_per_speaker)) %>%
slice_head(n=5) %>%
mutate(top = TRUE)
#inspect the data
top_speakers
# clean up speaker names
speaker_key <- rbind(prereform, postreform) %>%
select(speaker, suggested_speaker) %>%
filter(!str_detect(speaker, "Secretary")) %>%
filter(!str_detect(speaker, "Chancellor")) %>%
filter(!str_detect(speaker, "Minister")) %>%
group_by(suggested_speaker) %>%
sample_n(1)
# inspect the data
speaker_key %>% filter(str_detect(suggested_speaker, "peel_"))
speakers_w_top_and_speaker_key <- all_speakers_annotated %>%
rename(wordcount_per_speaker_per_year = wordcount) %>%
left_join(top_speakers, by = c("suggested_speaker", "class")) %>%
left_join(speaker_key) %>%
distinct()
#*********** STEPH this process generates multiple entires, which is why i resort to distinct(). do you have a more elegant solution? thanks! JG
#inspect the data
speakers_w_top_and_speaker_key %>%
filter(str_detect(suggested_speaker, "peel_")) %>%
select(speaker, top, year, wordcount_per_speaker_per_year, class) %>%
kable()
View(speakers_w_top_and_speaker_key)
speakers_w_top_and_speaker_key <- all_speakers_annotated %>%
rename(wordcount_per_speaker_per_year = wordcount) %>%
left_join(top_speakers, by = c("suggested_speaker", "class")) %>%
left_join(speaker_key) #%>%
#distinct()
#*********** STEPH this process generates multiple entires, which is why i resort to distinct(). do you have a more elegant solution? thanks! JG
#inspect the data
speakers_w_top_and_speaker_key %>%
filter(str_detect(suggested_speaker, "peel_")) %>%
select(speaker, top, year, wordcount_per_speaker_per_year, class) %>%
kable()
View(speakers_w_top_and_speaker_key)
speakers_w_top_and_speaker_key <- all_speakers_annotated %>%
rename(wordcount_per_speaker_per_year = wordcount) %>%
left_join(top_speakers, by = c("suggested_speaker", "class")) %>%
left_join(speaker_key) %>%
distinct()
#*********** STEPH this process generates multiple entires, which is why i resort to distinct(). do you have a more elegant solution? thanks! JG
#inspect the data
speakers_w_top_and_speaker_key %>%
filter(str_detect(suggested_speaker, "peel_")) %>%
select(speaker, top, year, wordcount_per_speaker_per_year, class) %>%
kable()
speakers_w_top_and_speaker_key <- all_speakers_annotated %>%
rename(wordcount_per_speaker_per_year = wordcount) %>%
left_join(top_speakers, by = c("suggested_speaker", "class")) %>%
left_join(speaker_key) #%>%
#distinct()
#*********** STEPH this process generates multiple entires, which is why i resort to distinct(). do you have a more elegant solution? thanks! JG
#inspect the data
speakers_w_top_and_speaker_key %>%
filter(str_detect(suggested_speaker, "peel_")) %>%
select(speaker, top, year, wordcount_per_speaker_per_year, class) %>%
kable()
speakers_w_top_and_speaker_key <- all_speakers_annotated %>%
rename(wordcount_per_speaker_per_year = wordcount) %>%
left_join(top_speakers, by = c("suggested_speaker", "class")) %>%
left_join(speaker_key)
#inspect the data
speakers_w_top_and_speaker_key %>%
filter(str_detect(suggested_speaker, "peel_")) %>%
select(speaker, top, year, wordcount_per_speaker_per_year, class) %>%
kable()
# graph it
library(ggrepel) # load a useful package for labeling a dense plot
ggplot(speakers_w_top_and_speaker_key, aes(x = year, y = wordcount_per_speaker_per_year, color = class, shape = class)) +
geom_jitter( # it's worth replacing the geom_jitter with geom_point here and in the next line to see the stakes of diff representations
size = 3
) +
scale_color_grey(guide = guide_legend()) +
geom_label_repel(data=subset(speakers_w_top_and_speaker_key, top == TRUE),
aes(label=speaker, color = class)) +
guides(fill = "none", label = "none", size = "none") +
theme(legend.position="bottom") +
labs(title = "How Much Did Speakers Speak",
subtitle = "Before and After the Second Reform Act of 1832?")
name <- c("Mrs. (Mary Ann) Clark", "Mrs. Bridgeman", "Miss Mary Ann Taylor", "Louisa Demont",
"Franchette Martigner", "Mrs. Walrand")
name_col_2 <- c("Ms. Cunninghame Graham", "Mrs. Dillon", "Mrs. M'Govern",
"Mrs. Mitchel-Thomson", "Ms. Cave", "")
year <- c("1809", "1809", "1809", "1820", "1820", "1824")
year_col_2 <- c("1887", "1902", "1902", "1907", "1907", "")
df <- data.frame(name, year, name_col_2, year_col_2)
df %>%
kable(col.names = c("Name", "Year", "Name", "Year")) %>%
kable_styling()
