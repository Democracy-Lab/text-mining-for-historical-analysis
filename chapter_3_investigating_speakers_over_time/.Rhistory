knitr::opts_chunk$set(echo = TRUE)
library(knitr)
# make a list of the names of the top speakers
pattern1 = c("Mr. Fowell Buxton", "Mr. Buckingham", "Mr. Stanley", "The Duke of Wellington", "Sir Robert Peel")
# search for the words said by the speakers in pattern1
top_slavery_speakers_1833 <- slavery_debates_1833 %>%
filter(speaker %in% pattern1) # keep rows containing a speaker's name
knitr::opts_chunk$set(echo = TRUE)
# load the hansardr library
library("hansardr")
# load the required data
data("speaker_metadata_1830")
head(speaker_metadata_1830)
library("tidytext")
library("tidyverse")
library("lubridate")
data("hansard_1830")
data("speaker_metadata_1830")
words_1830 <- hansard_1830 %>%
left_join(speaker_metadata_1830) %>%
select(speaker, suggested_speaker, text) %>%
unnest_tokens(word, text)
head(words_1830)
words_per_speaker_1830 <- words_1830 %>%
group_by(speaker)
words_per_speaker_1830 <- words_1830 %>%
group_by(suggested_speaker)
words_per_speaker_1830 <- words_1830 %>%
group_by(speaker) %>%
summarize(words_spoken = n()) %>%
arrange(desc(words_spoken))
head(words_per_speaker_1830)
words_per_speaker_1830 <- words_1830 %>%
filter(suggested_speaker != "") %>%
group_by(suggested_speaker) %>%
summarize(words_spoken = n()) %>%
arrange(desc(words_spoken))
head(words_per_speaker_1830)
custom_stop_words = tibble(word = c("hon", "speaker", "house", "question", "lord", "bill",
"committee", "duty", "country", "time", "amount", "government", "proposed", "law",
"measure", "learned", "law", "sir", "respect", "public", "gentleman", "gentlemen",
"friend", "noble", "parliament", "expenditure", "revenue", "tax", "principle", "proposal",
"consideration", "duties", "stated", "parliament", "act", "opinion", "inquiry", "effect",
"subject", "object", "motion", "baronet", "crown", "propose", "estimates", "sum",
"account", "ministers", "majesty", "proposition", "persons", "principles", "service",
"found", "propositions", "office", "matter", "statement", "paid", "increase", "moved",
"means", "considerable", "supply", "intention", "debt", "received", "expense", "estimate",
"charges", "resolution", "notice", "report", "parties", "party", "surplus", "commons",
"parties", "class", "commission", "form", "answer", "commissioners", "appointment",
"officers", "saving", "appeared", "granted", "late", "day", "future", "opportunity",
"saving", "officers", "information", "extent", "authority", "session", "justice",
"believed", "support", "character", "carried", "plan", "paper", "clause",  "opposite",
"system", "argument", "rate", "considered", "bills", "increase", "result", "reference",
"prepared", "laid", "portion", "passed", "intended", "chancellor", "taxation", "classes",
"appointed", "established", "parish", "confidence", "evidence", "pensions", "bring",
"income", "connected", "referred", "objection", "hoped", "adopted", "chancellor",
"account", "ministers", "occasion", "reduction", "reductions", "service", "services",
"attention", "vote", "brought", "forward", "purpose", "wish", "called", "period",
"money", "purpose", "power", "charge", "view", "circumstances", "trade", "taxes", "list",
"civil", "wished", "people", "discussion", "applied", "proper", "taking", "amendment",
"statements", "repeal", "papers", "fund", "feeling", "measures", "minister", "purposes",
"payment", "stock", "increased", "bound", "grant", "grounds", "doubt", "applied", "stamp",
"manner", "conduct", "exchequer", "provide", "reduced", "table", "difficulties",
"anxious", "compared", "provide", "king", "individual", "expressed", "hear", "hope",
"establishment", "debate", "contrary", "instance", "introduced", "call", "lords",
"existing", "half", "head", "offices", "views", "leave", "respecting", "speech", "feel",
"excise", "effected", "economy", "night", "price", "majority", "reason", "disposed",
"held", "claims", "leave", "required", "moment", "admitted", "ready", "words", "issue",
"allowed", "true", "treasury", "administration", "consent", "advantage", "business",
"calculated", "enter", "fair","nature", "oppose", "reign", "honour", "mode", "reduce",
"difficulty", "favour", "credit", "adopt", "additional", "individuals", "mind", "sale",
"times", "amounted", "deficiency", "laws", "til", "agreed", "alluded", "mentioned",
"meant", "heard", "feelings", "engaged", "consolidated", "conclusion", "circulation",
"begged", "calculations", "afford", "acts", "acted", "giving", "pledge", "matters",
"contract", "proceed", "determined", "satisfaction", "declare", "giving", "spirits",
"resolutions", "pursue", "opposition", "force","pursue", "force", "opinions", "refer",
"produce", "appeal", "pay", "terms", "private", "reform", "observations", "entitles",
"laws", "alteration", "due", "gallant", "joint", "undoubtedly", "alluded", "benefit",
"consequence", "perfectly", "trusted", "loan", "proceed", "cent", "regard", "political",
"royal", "carry", "importance", "proceedings", "aware", "rates", "similar", "examination",
"details", "told", "supposed", "sufficient", "person", "necessity", "millions",
"emoluments", "difference", "department", "till", "submit", "lay", "imposed", "claim",
"branches", "recommended", "privy", "personal", "select", "salary", "revenues",
"preceding", "practice", "move", "meet", "hand", "funds", "formed", "expenses",
"establishments", "entitled", "dimunition", "settlement", "sense", "arrangement",
"address", "sufficient", "local", "clergy", "relief", "necessity", "application", "claim",
"responsibility", "situation", "satisfactory", "ground", "revenues", "quarter", "change",
"founded", "secretary", "provided", "read", "commutation", "body", "provision",
"difference", "composition", "condition", "hands", "provision", "capital",
"responsibility", "press", "knowledge", "raised", "friends", "altogether", "meet", "hand",
"free", "difference", "claim", "necessity", "arguments", "left", "single", "founded",
"arrangement", "admit", "total", "told", "operation", "apply", "shown", "person",
"decision", "actual", "returns", "return", "restrictions", "national", "limited",
"hundred", "existed", "council", "charged", "annual", "allowances", "proceeding", "word",
"existed", "fairly", "loss", "spirit", "west", "sum"))
chancellor_of_the_exchequeur <- words_1830 %>%
filter(str_detect(speaker, "Exchequer"),
str_detect(word, "[a-z]"),
suggested_speaker != "john_spencer_1234",
suggested_speaker != "rigby_wason_3024",
suggested_speaker != "",
suggested_speaker != "chancellor of the exchequerr") %>%
anti_join(stop_words) %>%
anti_join(custom_stop_words) %>%
group_by(suggested_speaker, word) %>%
summarize(n = n()) %>%
top_n(35) %>%
ungroup()
chancellor_of_the_exchequeur %>%
sample_n(5) %>%
head()
chancellor_of_the_exchequeur <- chancellor_of_the_exchequeur %>%
mutate(word = reorder_within(word, n, suggested_speaker))
ggplot(data = chancellor_of_the_exchequeur,
aes(x = word, y = n)) +
geom_col() +
scale_x_reordered() +
coord_flip() +
facet_wrap(~suggested_speaker, scales = "free") +
labs(x = "word", y = "speaker") +
ggtitle("Favorite Words of Each Chancellor of the Exchequer in the 1830s")
date1 <- mdy("6/24/1819")
date1
year1 <- year(date1)
year1
library("kableExtra")
data("debate_metadata_1830")
hansard_1830_w_year <- hansard_1830 %>%
left_join(debate_metadata_1830) %>%
mutate(year = year(speechdate))
hansard_1830_w_year %>%
head() %>%
kable()
hansard_1830_w_year %>%
head() %>%
mutate(text = str_trunc(text, 120)) %>%
kable("html", booktabs = TRUE) %>%
kable_styling(full_width = FALSE, position = "left") %>%
column_spec(2, width = "6cm") %>%
column_spec(4, width = "4cm")
words_1830_w_year <- hansard_1830_w_year %>%
left_join(speaker_metadata_1830) %>%
select(speaker, suggested_speaker, text, year) %>%
unnest_tokens(word, text)
words_1830_w_year %>%
head() %>%
select(speaker, word, year) %>%
kable() #look at the first few columns of the dataset
words_per_speaker_1830 <- words_1830_w_year %>%
filter(suggested_speaker != "") %>%
group_by(speaker, year) %>%
summarize(speaker_words_per_year = n()) %>%
arrange(desc(speaker_words_per_year))
head(words_per_speaker_1830)
data("hansard_1820")
data("speaker_metadata_1820")
data("file_metadata_1820")
mrs_walrand_speaker_metadata <- speaker_metadata_1820 %>%
filter(str_detect(speaker, regex("Mrs(.*)Walrand", ignore_case = T)))
mrs_walrand_sentences <- left_join(mrs_walrand_speaker_metadata,
file_metadata_1820, by = "sentence_id") %>%
left_join(., hansard_1820, by = "sentence_id") %>%
select(debate_id, text)
mrs_walrand_sentences %>%
head() %>%
mutate(text = str_trunc(text, 120)) %>%
kable(format = "latex",
booktabs = TRUE,
caption = "Sentences uttered by Mrs. Walrand in the 1820 Hansard debates.") %>%
kable_styling(full_width = FALSE, position = "left") %>%
column_spec(2, width = "10cm")
entire_debate <- hansard_1820 %>%
left_join(file_metadata_1820, hansard_1820, by = "sentence_id") %>%
filter(debate_id == 5142) %>%
select("text")
debate_table <- tibble(text = head(entire_debate$text, 20))
debate_table %>%
kable(format = "latex",
booktabs = TRUE,
caption = "Excerpt of Debate Text (First 20 Sentences)") %>%
kable_styling(latex_options = c("hold_position", "scale_down"),
full_width = FALSE,
position = "left") %>%
column_spec(1, width = "16cm")
mrs_walrand_top_words <- left_join(mrs_walrand_speaker_metadata, hansard_1820) %>%
unnest_tokens(word, text) %>%
anti_join(stop_words) %>%
filter(is.na(as.numeric(word))) %>%
group_by(speaker, word) %>%
summarize(n = n()) %>%
arrange(desc(n)) %>%
top_n(30)
ggplot(data = mrs_walrand_top_words,
aes(x = reorder(word, n), y = n)) +
geom_col() +
coord_flip() +
labs(title = "Mrs. Walrand\'s Top Words",
subtitle = "From \"Motion Respecting the Trial and Condemnation of
Missionary Smith at Demerara\"",
x = "Word",
y = "Count")
# make two categories, pre- and post-reform
debate_metadata_1820 <- debate_metadata_1820 %>%
mutate(speechdate = as.Date(as.character(speechdate)))
debate_metadata_1830 <- debate_metadata_1830 %>%
mutate(speechdate = as.Date(as.character(speechdate)))
debate_metadata_1840 <- debate_metadata_1840 %>%
mutate(speechdate = as.Date(as.character(speechdate)))
hansard_1820 <- hansard_1820 %>%
left_join(speaker_metadata_1820) %>%
left_join(debate_metadata_1820)
hansard_1830 <- hansard_1830 %>%
left_join(speaker_metadata_1830) %>%
left_join(debate_metadata_1830)
hansard_1840 <- hansard_1840 %>%
left_join(speaker_metadata_1840) %>%
left_join(debate_metadata_1840)
hansard <- bind_rows(hansard_1820, hansard_1830, hansard_1840)
# find all the prereform text and speaker names
prereform <- hansard %>% #hansard_1830 %>%
select(sentence_id, speechdate, debate, text, speaker, suggested_speaker) %>%
filter(speechdate <= as.Date("1832-6-4")) %>%
filter(speechdate >= as.Date("1822-6-4")) %>%
mutate(year = year(speechdate)) %>%
mutate(suggested_speaker = coalesce(suggested_speaker, speaker)) %>% # the "coalesce" function replaces a NA in the suggested_speaker column with whatever is in the speaker column
# filter(!is.na(speaker)) %>% ## a different count will result if we use this line as an alternative to the above
mutate(period = "prereform")
# find all the postreform text and speaker names
postreform <- hansard %>% #hansard_1830 %>%
select(sentence_id, speechdate, debate, text, speaker, suggested_speaker) %>%
filter(speechdate >= as.Date("1832-6-4")) %>%
filter(speechdate <= as.Date("1842-6-4")) %>%
mutate(year = year(speechdate)) %>%
mutate(suggested_speaker = coalesce(suggested_speaker, speaker)) %>% # the "coalesce" function replaces a NA in the suggested_speaker column with whatever is in the speaker column
#filter(!is.na(speaker)) %>% ## a different count will result if we use this line as an alternative to the above
mutate(period = "postreform")
# tokenize words (this may be slow -- give it time)
prereform_words <- prereform %>%
unnest_tokens(word, text)
postreform_words <- postreform %>%
unnest_tokens(word, text)
# count the words
prereform_word_count <- prereform_words %>%
anti_join(stop_words) %>%
group_by(word) %>%
summarise(wordcount = n()) %>%
ungroup() %>%
arrange(desc(wordcount))  %>%
mutate(period = "prereform")
postreform_word_count <- postreform_words %>%
anti_join(stop_words) %>%
group_by(word) %>%
summarise(wordcount = n()) %>%
ungroup() %>%
arrange(desc(wordcount)) %>%
mutate(period = "postreform")
# glue the data together
both_periods_word_count <- bind_rows(prereform_word_count, postreform_word_count)
# tell the computer to put the periods in the correct order
both_periods_word_count$period <- factor(both_periods_word_count$period, levels = c("prereform", "postreform"))
# add up the total words for each period
both_periods_word_count_totals <- both_periods_word_count %>%
group_by(period) %>%
summarize(total = sum(wordcount))
# create a bar chart
library(scales) # a library useful for formatting numbers
ggplot(both_periods_word_count_totals, aes(x = period, y = total)) +
geom_col((aes(fill = period))) +
scale_fill_grey() +
scale_y_continuous(label=comma) +
geom_text(aes(label = (paste0(scales::comma(total), " words"))),
colour = "white",
vjust = 1.5) +
labs(title = "How Many Words Were Spoken in Each Period?", x = "", y = "words")
# subtract the prereform total wordcount from the postreform total word count to find the difference
both_periods_word_count_totals$total[2] - both_periods_word_count_totals$total[1]
# top words
top_words <- both_periods_word_count %>%
group_by(period) %>%
slice_max(order_by = wordcount, # put the words in descending order by "wordcount," the column for the count
n = 10) # the argument "n" for the function "slice_max" takes the number of positions from the top to retain
library(gt)
# make a table
top_words %>%
gt() %>% # we're using the "great tables" package to make an elegant table
fmt_number( # format the numbers in the table
columns = everything(), # apply to all numbers
decimals = 0, # no decimals
use_seps = TRUE # use commas
) %>%
tab_header(title = "The Top Ten Words Spoken in Prereform and Postreform Parliament") %>%
tab_style(
style = list(cell_text(weight = "bold")),
locations = cells_row_groups()
) %>%
tab_style( # format the column labels
style = list(
cell_fill(color = "black"),
cell_text(weight = "bold", color = "white")
),
locations = cells_column_labels()
) %>%
tab_style( # format the title
style = list(
cell_fill(color = "lightgray"),
cell_text(weight = "bold")
),
locations = cells_title()
)
# count words per speaker per year
prereform_speakers_wordcount <- prereform_words %>%
filter(str_trim(suggested_speaker) != "") %>%
group_by(suggested_speaker, year) %>%
summarize(wordcount = n()) %>%
ungroup() %>%
mutate(period = "prereform")
postreform_speakers_wordcount <- postreform_words %>%
filter(str_trim(suggested_speaker) != "") %>%
group_by(suggested_speaker, year) %>%
summarize(wordcount = n()) %>%
ungroup() %>%
mutate(period = "postreform")
# glue them together
both_periods_speakers <- rbind(prereform_speakers_wordcount, postreform_speakers_wordcount)
# inspect the data
head(both_periods_speakers)
# take the top speakers by wordcount
words_per_speaker <- both_periods_speakers %>%
group_by(suggested_speaker) %>%
summarize(wordsperspeaker = sum(wordcount))
top_speakers <- words_per_speaker %>%
slice_max(wordsperspeaker,
n = 5)
# inspect the data
top_speakers
# Use counting to investigate how many distinct speakers are in the data, pre and postreform
# How many speakers were there prereform?
prereform_only_speakers <- prereform_speakers_wordcount %>%
select(suggested_speaker) %>%
anti_join(postreform_speakers_wordcount, by = "suggested_speaker") %>%
mutate(class = "prereform only")
# inspect the data
head(prereform_only_speakers)
# count the number of speakers in the dataset
nrow(prereform_only_speakers)
# How many speakers were there postreform?
postreform_only_speakers <- postreform_speakers_wordcount %>%
select(suggested_speaker) %>%
anti_join(prereform_speakers_wordcount) %>%
mutate(class = "postreform only")
# inspect the data
head(postreform_only_speakers)
# count the number of speakers in the dataset
nrow(postreform_only_speakers)
nrow(postreform_only_speakers) - nrow(prereform_only_speakers)
# How Many Members of Parliament Spoke Both Prereform and Postreform?
continuous_speakers <- prereform_speakers_wordcount %>%
distinct(suggested_speaker) %>%
inner_join(postreform_speakers_wordcount) %>%
ungroup() %>%
mutate(class = "both periods") %>%
distinct(suggested_speaker, class)
nrow(continuous_speakers)
# Count the number of speakers in each category
# glue together the data from each smaller dataset
all_classes <- rbind(prereform_only_speakers, postreform_only_speakers, continuous_speakers)
# group by period and count the number of speakers
all_classes_count <- all_classes %>%
group_by(class) %>%
summarize(speakercount = n()) %>%
arrange(desc(class))
# tell the computer to put the periods in the correct order
all_classes_count$class <- factor(all_classes_count$class, levels = c("prereform only", "postreform only", "both periods"))
# create a bar chart
ggplot(all_classes_count, aes(x = class, y = speakercount)) +
geom_col((aes(fill = class))) +
scale_fill_grey() +
geom_text(aes(label = paste0(speakercount, " speakers")),
colour = "white",
vjust = 1.5) +
labs(title = "How Many Speakers are in Each Category?", x = "", y = "speakers")
## Using Word Count:
## How much did speakers speak before and after the reform act?
# glue the data together for processing
all_per_speaker_wordcounts <- bind_rows(prereform_speakers_wordcount, postreform_speakers_wordcount) %>%
ungroup()
# create a database of speaker, year, and wordcount
all_speakers_annotated <- all_per_speaker_wordcounts %>%
left_join(all_classes) %>%
filter(!is.na(suggested_speaker)) %>%
ungroup()
# inspect the data
all_speakers_annotated
# find the total wordcount_per_speaker
wordcount_per_speaker <-  all_speakers_annotated %>%
rename(wordcount_per_speaker_per_year = wordcount) %>%
group_by(class, suggested_speaker) %>%
summarize(wordcount_per_speaker = sum(wordcount_per_speaker_per_year))
# find the most prolific n speakers of each period
top_speakers <- wordcount_per_speaker %>%
filter(!is.na(suggested_speaker)) %>%
group_by(class) %>%
arrange(desc(wordcount_per_speaker)) %>%
slice_head(n=5) %>%
mutate(top = TRUE)
#inspect the data
top_speakers
# clean up speaker names
speaker_key <- rbind(prereform, postreform) %>%
select(speaker, suggested_speaker) %>%
filter(!str_detect(speaker, "Secretary")) %>%
filter(!str_detect(speaker, "Chancellor")) %>%
filter(!str_detect(speaker, "Minister")) %>%
group_by(suggested_speaker) %>%
sample_n(1)
# inspect the data
speaker_key %>% filter(str_detect(suggested_speaker, "peel_"))
speakers_w_top_and_speaker_key <- all_speakers_annotated %>%
rename(wordcount_per_speaker_per_year = wordcount) %>%
left_join(top_speakers, by = c("suggested_speaker", "class")) %>%
left_join(speaker_key) %>%
distinct()
#*********** STEPH this process generates multiple entires, which is why i resort to distinct(). do you have a more elegant solution? thanks! JG
#inspect the data
speakers_w_top_and_speaker_key %>%
filter(str_detect(suggested_speaker, "peel_")) %>%
select(speaker, top, year, wordcount_per_speaker_per_year, class) %>%
kable()
# graph it
library(ggrepel) # load a useful package for labeling a dense plot
ggplot(speakers_w_top_and_speaker_key, aes(x = year, y = wordcount_per_speaker_per_year, color = class, shape = class)) +
geom_jitter( # it's worth replacing the geom_jitter with geom_point here and in the next line to see the stakes of diff representations
size = 3
) +
scale_color_grey(guide = guide_legend()) +
geom_label_repel(data=subset(speakers_w_top_and_speaker_key, top == TRUE),
aes(label=speaker, color = class)) +
guides(fill = "none", label = "none", size = "none") +
theme(legend.position="bottom") +
labs(title = "How Much Did Speakers Speak",
subtitle = "Before and After the Second Reform Act of 1832?")
name <- c("Mrs. (Mary Ann) Clark", "Mrs. Bridgeman", "Miss Mary Ann Taylor", "Louisa Demont",
"Franchette Martigner", "Mrs. Walrand")
name_col_2 <- c("Ms. Cunninghame Graham", "Mrs. Dillon", "Mrs. M'Govern",
"Mrs. Mitchel-Thomson", "Ms. Cave", "")
year <- c("1809", "1809", "1809", "1820", "1820", "1824")
year_col_2 <- c("1887", "1902", "1902", "1907", "1907", "")
df <- data.frame(name, year, name_col_2, year_col_2)
df %>%
kable(col.names = c("Name", "Year", "Name", "Year")) %>%
kable_styling()
